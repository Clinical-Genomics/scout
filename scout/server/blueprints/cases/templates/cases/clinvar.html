{% from "cases/utils.html" import pretty_variant %}

{% macro clinvar_vars(institute, case, suspects) %}
  <div class="card panel-default">
    <div>
      <div class="d-flex justify-content-between" data-bs-toggle='tooltip' title="Variants included in a ClinVar submission object in Scout">
        <h6><span class="fa fa-map-pin ms-3 mt-2"></span>&nbsp;Variants submitted to ClinVar ({{ case.clinvar_variants.items()|length }})
        </h6>
      </div>
    </div>
    <div class="card">
      {% if suspects %}
      <div class="checkbox-group required ms-3">
        <form id="clinvar_submit" action="{{ url_for('variant.clinvar_create', institute_id=institute._id, case_name=case.display_name) }}" method="POST">
          <input type="hidden" name="old_submitted" value="{{case.clinvar_variants.keys()|list|join(',')}}">
          <div class="checkbox-group required">
          {% for variant in suspects %}
            {% if variant._id %} <!-- variant was not removed after reupload -->
              <input class="ml-3" type="checkbox" name="clinvar_variant" value="{{variant._id}}"
              {% if variant.category == 'str' or variant._id in case.clinvar_variants.keys() %} disabled {% endif %}
              >
              {{pretty_variant(variant)}} {% if variant._id in case.clinvar_variants.keys() %} - <em>Already submitted</em> - {% endif %}

              <br>
            {% endif %}
          {% endfor %}
          </div>
          <div class=btn-group" role="group" aria-label="ClinVar btns">
            <button class="mb-3 mt-3 btn btn-secondary btn-sm" type="submit" name="submit_pinned" value="submit">
              Submit variants
            </button>
            <a href="{{ url_for('overview.clinvar_submissions', institute_id=institute._id) }}" class="mb-3 mt-3 btn btn-secondary btn-sm text-white" target="_blank">Link to submission</a>
          </div>
        </form>
      {% elif case.clinvar_variants %}
        <a href="{{ url_for('overview.clinvar_submissions', institute_id=institute._id) }}" class="mb-3 mt-3 btn btn-secondary btn-sm text-white" target="_blank" rel="noopener noreferrer">Modify clinvar submission</a>
      {% endif %}
    </div> <!--end of <div class="panel-body">-->
  </div>
{% endmacro %}
