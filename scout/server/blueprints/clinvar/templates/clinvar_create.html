{% extends "layout.html" %}

{% block title %}
  {{ super() }} - {{ institute.display_name }} - {{ case.display_name }} - {{ variant.display_name }}
{% endblock %}

{% block css %}
{{ super() }}
{% endblock %}

{% block top_nav %}
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('overview.cases', institute_id=institute._id) }}">
      {{ institute.display_name }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('cases.case', institute_id=institute._id, case_name=case.display_name) }}">
      {{ case.display_name }}
    </a>
  </li>
{% endblock %}

{% block content_main %}
<p class="mt-3 mb-3">
<a class="mt-3" href="https://www.ncbi.nlm.nih.gov/clinvar/intro/" target="_blank">Clinvar</a> is a freely accessible archive of clinically relevant variants.
  Contributing to this database helps improving data sharing and increasing the number of genetic diagnoses worldwide.<br>
  The form present on this page mirrors the fields on the Clinvar submission spreadsheets. After collecting all the required fields for submitting one or more variants to Clinvar, the info is subsequently processed into comma separated files, ready to be uploaded in the submission process.<br>
  Link to the official Clinvar <a href="https://www.ncbi.nlm.nih.gov/clinvar/docs/spreadsheet/#sub_info" target="_blank">documentation</a>.
</p>
<div class="accordion" id="clinvar_accordion">
{% for vardata in variant_data %}
{% if vardata.var_obj.category in ["snv", "cancer"]%}
  {% set var_category = 'snv' %}
{% else %}
  {% set var_category = 'sv' %}
{% endif %}
<div class="accordion-item">
  <h2 class="accordion-header" id="heading_{{vardata.var_id}}">
      <button class="ml-3 accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_{{vardata.var_id}}" aria-expanded="true" aria-controls="collapse_{{vardata.var_id}}">
      <span class="badge {% if vardata.var_obj.category == 'sv'%} bg-warning {% else %} bg-secondary {% endif %}">{{vardata.var_obj.category}}</span>&nbsp;&nbsp;{{vardata.var_obj.simple_id|truncate(50, True) }}
    </button>
  </h2>
  <div id="collapse_{{vardata.var_id}}" class="accordion-collapse collapse" aria-labelledby="heading_{{vardata.var_id}}" data-bs-parent="#clinvar_accordion">
    <div class="accordion-body">
      <form method="POST" action="{{ url_for('clinvar.add_variant', institute_id=institute._id, case_name=case.display_name) }}" id="{{vardata.var_id}}_form">
        <!-- hidden fields -->
        {{ vardata.var_form.category() }}
        {{ vardata.var_form.local_id() }}
        {{ vardata.var_form.linking_id() }}
        {{ vardata.var_form.chromosome() }}
        {{ vardata.var_form.ref() }}
        {{ vardata.var_form.alt() }}
        <!-- SNVs only -->
        {% if var_category == 'snv' %}
          {{ vardata.var_form.start() }}
          {{ vardata.var_form.stop() }}
        {% endif %}
        <!-- end of hidden fields -->

        <div class="row">
          <h5>Variant data</h5>
          <div class="col-6">
            <table class="table table-bordered table-fixed">
              <tbody>
                <tr> <!-- gene symbols -->
                  <td>{{vardata.var_form.gene_symbols.label}}</td>
                  <td>{{vardata.var_form.gene_symbols()}}</td>
                </tr>

                {% if var_category == 'snv' %}
                  <tr> <!-- Transcripts & HGVS:(optional) -->
                    <td>{{vardata.var_form.tx_hgvs.label}}</td>
                    <td>{{vardata.var_form.tx_hgvs()}}</td>
                  </tr>

                  <tr> <!-- dbSNP identifier -->
                    <td>{{vardata.var_form.dbsnp_id.label}}</td>
                    <td>{{vardata.var_form.dbsnp_id()}}</td>
                  </tr>

                {% endif %}

                <tr> <!-- model of inherintance -->
                  <td>{{vardata.var_form.inheritance_models.label}}</td>
                  <td>{{vardata.var_form.inheritance_models()}}</td>
                </tr>

                <tr> <!-- Clinical significance -->
                  <td>{{vardata.var_form.clinsig.label}}</td>
                  <td>{{vardata.var_form.clinsig()}}</td>
                </tr>

                <tr> <!-- Clinical significance comment -->
                  <td>{{vardata.var_form.clinsig_comment.label}}</td>
                  <td>{{vardata.var_form.clinsig_comment(class="form-control", placeholder="(optional)")}}</td>
                </tr>

                <tr> <!-- Clinical significance citation -->
                  <td>{{vardata.var_form.clinsig_cit.label}}</td>
                  <td>{{vardata.var_form.clinsig_cit(class="form-control", placeholder="(optional) e.g. PMID:123456,  PMCID:PMC3385229, NBK:56955")}}</td>
                </tr>

                {% if var_category == 'sv' %}
                  <tr> <!-- Variant type -->
                    <td>{{vardata.var_form.sv_type.label}}</td>
                    <td>{{vardata.var_form.sv_type()}}</td>
                  </tr>

                  <tr> <!-- Reference copy number -->
                    <td>{{vardata.var_form.ref_copy_number.label}}</td>
                    <td>{{vardata.var_form.ref_copy_number()}}</td>
                  </tr>

                  <tr> <!-- Copy number -->
                    <td>{{vardata.var_form.copy_number.label}}</td>
                    <td>{{vardata.var_form.copy_number()}}</td>
                  </tr>

                  <tr> <!-- Outer start -->
                    <td>{{vardata.var_form.outer_start.label}}</td>
                    <td>{{vardata.var_form.outer_start()}}</td>
                  </tr>

                  <tr> <!-- Inner start -->
                    <td>{{vardata.var_form.inner_start.label}}</td>
                    <td>{{vardata.var_form.inner_start()}}</td>
                  </tr>

                  <tr> <!-- Inner stop -->
                    <td>{{vardata.var_form.inner_stop.label}}</td>
                    <td>{{vardata.var_form.inner_stop()}}</td>
                  </tr>

                  <tr> <!-- Outer stop -->
                    <td>{{vardata.var_form.outer_stop.label}}</td>
                    <td>{{vardata.var_form.outer_stop()}}</td>
                  </tr>
                {% endif  %}

              </tbody>
            </table>
          </div>
          <div class="col-6">
            <table class="table table-bordered table-fixed">
              <tbody>

                <tr> <!-- Date last eveluation -->
                  <td>{{vardata.var_form.eval_date.label}}</td>
                  <td>{{vardata.var_form.eval_date()}}</td>
                </tr>

                <tr> <!-- HPO terms -->
                  <td>{{vardata.var_form.hpo_terms.label}}</td>
                  <td>{{vardata.var_form.hpo_terms()}}</td>
                </tr>

                <tr> <!-- OMIM terms -->
                  <td>{{vardata.var_form.omim_terms.label}}</td>
                  <td>{{vardata.var_form.omim_terms()}}</td>
                </tr>

                <tr> <!-- Additional comments for condition -->
                  <td>{{vardata.var_form.variant_condition_comment.label}}</td>
                  <td>{{vardata.var_form.variant_condition_comment(class="form-control")}}</td>
                </tr>

                <tr> <!-- Assertion method -->
                  <td>{{vardata.var_form.assertion_method.label}}</td>
                  <td>{{vardata.var_form.assertion_method()}}</td>
                </tr>

                <tr> <!-- Assertion method citation -->
                  <td>{{vardata.var_form.assertion_method_cit.label}}</td>
                  <td>{{vardata.var_form.assertion_method_cit(class="form-control")}}</td>
                </tr>

              </tbody>
            </table>
          </div>
        </div> <!-- end of variant row -->
        <div class="row">
          <h5>Observation data</h5>
          <ul class="list-group">
          {% for obs_form in vardata.obs_forms %}
            <li class="list-group-item">
              <table class="table table-fixed">
                <tbody>
                  <tr>
                    {{obs_form.linking_id}} <!-- hidden field -->
                    <td>
                      {{ obs_form.individual_id.label }}
                      {{ obs_form.individual_id() }}
                    </td>
                    <td>
                      {{ obs_form.include_ind.label }}
                      {{ obs_form.include_ind() }}
                    </td>
                    <td>
                      {{ obs_form.affected_status.label }}
                      {{ obs_form.affected_status() }}
                    </td>
                    <td>
                      {{ obs_form.allele_of_origin.label }}
                      {{ obs_form.allele_of_origin() }}
                    </td>
                    <td>
                      {{ obs_form.collection_method.label }}
                      {{ obs_form.collection_method() }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </li>
          {% endfor %}
          </ul>
        </div>
        <div class="d-flex justify-content-center">
          {{ vardata.var_form.submit_btn(class="btn btn-primary") }}
        </div>
      </form>
    </div>
  </div>
</div> <!-- end of class="accordion-item" div -->
{% endfor %}
</div> <!-- end of accordion div -->
{% endblock %}


{% block scripts %}
{{ super() }}
{% endblock %}
