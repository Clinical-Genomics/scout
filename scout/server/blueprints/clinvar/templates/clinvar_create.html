{% extends "layout.html" %}

{% block title %}
  {{ super() }} - {{ institute.display_name }} - {{ case.display_name }} - {{ variant.display_name }}
{% endblock %}

{% block css %}
{{ super() }}
{% endblock %}

{% block top_nav %}
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('overview.cases', institute_id=institute._id) }}">
      {{ institute.display_name }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('cases.case', institute_id=institute._id, case_name=case.display_name) }}">
      {{ case.display_name }}
    </a>
  </li>
{% endblock %}

{% block content_main %}
<p class="mt-3 mb-3">
<a class="mt-3" href="https://www.ncbi.nlm.nih.gov/clinvar/intro/" target="_blank">Clinvar</a> is a freely accessible archive of clinically relevant variants.
  Contributing to this database helps improving data sharing and increasing the number of genetic diagnoses worldwide.<br>
  The form present on this page mirrors the fields on the Clinvar submission spreadsheets. After collecting all the required fields for submitting one or more variants to Clinvar, the info is subsequently processed into comma separated files, ready to be uploaded in the submission process.<br>
  Link to the official Clinvar <a href="https://www.ncbi.nlm.nih.gov/clinvar/docs/spreadsheet/#sub_info" target="_blank">documentation</a>.
</p>
<div class="accordion" id="clinvar_accordion">
{% for vardata in variant_data %}
{% if vardata.var_obj.category in ["snv", "cancer"]%}
  {% set var_category = 'snv' %}
{% else %}
  {% set var_category = 'sv' %}
{% endif %}
<div class="accordion-item">
  <h2 class="accordion-header" id="heading_{{vardata.var_id}}">
      <button class="ml-3 accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_{{vardata.var_id}}" aria-expanded="true" aria-controls="collapse_{{vardata.var_id}}">
      <span class="badge {% if vardata.var_obj.category == 'sv'%} bg-warning {% else %} bg-secondary {% endif %}">{{vardata.var_obj.category}}</span>&nbsp;&nbsp;{{vardata.var_obj.simple_id|truncate(50, True) }}
    </button>
  </h2>
  <div id="collapse_{{vardata.var_id}}" class="accordion-collapse collapse" aria-labelledby="heading_{{vardata.var_id}}" data-bs-parent="#clinvar_accordion">
    <div class="accordion-body">
      <form method="POST" action="{{ url_for('clinvar.add_variant', institute_id=institute._id, case_name=case.display_name) }}" id="{{vardata.var_id}}_form">
        <!-- hidden fields -->
        {{ vardata.var_form.category() }}
        {{ vardata.var_form.local_id() }}
        {{ vardata.var_form.linking_id() }}
        {{ vardata.var_form.chromosome() }}
        {{ vardata.var_form.ref() }}
        {{ vardata.var_form.alt() }}
        <!-- SNVs only -->
        {% if var_category == 'snv' %}
          {{ vardata.var_form.start() }}
          {{ vardata.var_form.stop() }}
        {% endif %}
        <!-- end of hidden fields -->
        <h5>Variant data</h5>
        <div class="row d-flex align-items-center mt-3">
          <div class="col-2"><!-- gene symbols -->
            <div class="col-4">{{vardata.var_form.gene_symbols.label}}</div>
            <div>{{vardata.var_form.gene_symbols()}}</div>
          </div>
          <div class="col-2"><!-- Date last eveluation -->
            <div class="col-6">{{vardata.var_form.eval_date.label}}</div>
            <div>{{vardata.var_form.eval_date()}}</div>
          </div>
          <div class="col-3"><!-- model of inherintance -->
            {{vardata.var_form.inheritance_models.label}}
            {{vardata.var_form.inheritance_models(class="form-control")}}
          </div>
          <div class="col-2"><!-- Assertion method -->
            {{vardata.var_form.assertion_method.label}}
            {{vardata.var_form.assertion_method()}}
          </div>
          <div class="col-2"><!-- Assertion method citation -->
            {{vardata.var_form.assertion_method_cit.label}}
            {{vardata.var_form.assertion_method_cit(class="form-control")}}
          </div>
        </div>
        <div class="row d-flex align-items-center mt-3">
          {% if var_category == 'snv' %}
            <div class="col-3"><!-- Transcripts & HGVS:(optional) -->
              {{vardata.var_form.tx_hgvs.label}}
              {{vardata.var_form.tx_hgvs(class="form-control")}}
            </div>
            <div class="col-3"><!-- dbSNP identifier -->
              {{vardata.var_form.dbsnp_id.label}}
              {{vardata.var_form.dbsnp_id()}}
            </div>
          {% else %} <!--SV variant-->
            <div class="col-2"><!-- Variant type -->
              {{vardata.var_form.sv_type.label}}
              {{vardata.var_form.sv_type(class="form-control")}}
            </div>
            <div class="col-2"><!-- Reference copy number -->
              {{vardata.var_form.ref_copy_number.label}}
              {{vardata.var_form.ref_copy_number()}}
            </div>
            <div class="col-2"><!-- Copy number -->
              {{vardata.var_form.copy_number.label}}
              {{vardata.var_form.copy_number()}}
            </div>
            <div class="col-6">
              <div class="d-flex justify-content-start"><!-- Outer start -->
                <div class="col-3">{{vardata.var_form.outer_start.label}}</div>
                <div class="col-9">{{vardata.var_form.outer_start(class="form-control")}}</div>
              </div>
              <div class="d-flex justify-content-start"><!-- Inner start -->
                <div class="col-3">{{vardata.var_form.inner_start.label}}</div>
                <div class="col-9">{{vardata.var_form.inner_start(class="form-control")}}</div>
              </div>
              <div class="d-flex justify-content-start"><!-- Inner stop -->
                <div class="col-3">{{vardata.var_form.inner_stop.label}}</div>
                <div class="col-9">{{vardata.var_form.inner_stop(class="form-control")}}</div>
              </div>
              <div class="d-flex justify-content-start"><!-- Outer stop -->
                <div class="col-3">{{vardata.var_form.outer_stop.label}}</div>
                <div class="col-9">{{vardata.var_form.outer_stop(class="form-control")}}</div>
              </div>
            </div>
          {% endif %}
        </div>
        <div class="row d-flex align-items-center mt-3">
          <div class="col-4"><!-- Clinical significance -->
            {{vardata.var_form.clinsig.label}}
            {{vardata.var_form.clinsig(class="form-control")}}
          </div>
          <div class="col-4"> <!-- Clinical significance comment -->
            {{vardata.var_form.clinsig_comment.label}}
            {{vardata.var_form.clinsig_comment(class="form-control", placeholder="(optional)")}}
          </div>
          <div class="col-4"> <!-- Clinical significance citation -->
            {{vardata.var_form.clinsig_cit.label}}
            {{vardata.var_form.clinsig_cit(class="form-control", placeholder="(optional) e.g. PMID:123456,  PMCID:PMC3385229, NBK:56955")}}
          </div>
        </div>
        <div class="row d-flex align-items-center mt-3">
          <div class="col-4"><!-- HPO terms -->
            {{vardata.var_form.hpo_terms.label}}
            {{vardata.var_form.hpo_terms()}}
          </div>
          <div class="col-4"><!-- OMIM terms -->
            {{vardata.var_form.omim_terms.label}}
            {{vardata.var_form.omim_terms}}
          </div>
          <div class="col-4"><!-- Additional comments for condition -->
            {{vardata.var_form.variant_condition_comment.label}}
            {{vardata.var_form.variant_condition_comment(class="form-control")}}
          </div>
        </div>



        <div class="row d-flex align-items-center mt-3">
        <div class="row mt-3">
          <h5>Observation data</h5>
          <ul class="list-group">
          {% for cdata in vardata.cdata_forms %}
            <li class="list-group-item">
              <table class="table table-fixed">
                <tbody>
                  <tr>
                    {{cdata.linking_id}} <!-- hidden field -->
                    <td>
                      {{ cdata.individual_id.label }}
                      {{ cdata.individual_id() }}
                    </td>
                    <td>
                      {{ cdata.include_ind.label }}
                      {{ cdata.include_ind() }}
                    </td>
                    <td>
                      {{ cdata.affected_status.label }}
                      {{ cdata.affected_status() }}
                    </td>
                    <td>
                      {{ cdata.allele_of_origin.label }}
                      {{ cdata.allele_of_origin() }}
                    </td>
                    <td>
                      {{ cdata.collection_method.label }}
                      {{ cdata.collection_method() }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </li>
          {% endfor %}
          </ul>
        </div>
        <div class="d-flex justify-content-center">
          {{ vardata.var_form.submit_btn(class="btn btn-primary") }}
        </div>
      </form>
    </div>
  </div>
</div> <!-- end of class="accordion-item" div -->
{% endfor %}
</div> <!-- end of accordion div -->
{% endblock %}


{% block scripts %}
{{ super() }}
{% endblock %}
