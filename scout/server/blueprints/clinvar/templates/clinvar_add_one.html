{% extends "layout.html" %}

{% block title %}
  {{ super() }} - {{ institute.display_name }} - {{ case.display_name }} - {{ variant.display_name }}
{% endblock %}

{% block css %}
{{ super() }}
{% endblock %}

{% block top_nav %}
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('overview.cases', institute_id=institute._id) }}">
      {{ institute.display_name }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('cases.case', institute_id=institute._id, case_name=case.display_name) }}">
      {{ case.display_name }}
    </a>
  </li>
{% endblock %}

{% block content_main %}
<p class="mt-3 mb-3">
<a class="mt-3" href="https://www.ncbi.nlm.nih.gov/clinvar/intro/" target="_blank">Clinvar</a> is a freely accessible archive of clinically relevant variants.
  Contributing to this database helps improving data sharing and increasing the number of genetic diagnoses worldwide.<br>
  The form present on this page mirrors the fields on the Clinvar submission spreadsheets. After collecting all the required fields for submitting one or more variants to Clinvar, the info is subsequently processed into comma separated files, ready to be uploaded in the submission process.
  Link to the official Clinvar <a href="https://www.ncbi.nlm.nih.gov/clinvar/docs/spreadsheet/#sub_info" target="_blank">documentation</a>.
</p>

<div> <!-- Container of ClinVar variant submission form-->
  {% if variant_data.var_obj.category in ["snv", "cancer"]%}
    {% set var_category = 'snv' %}
  {% else %}
    {% set var_category = 'sv' %}
  {% endif %}
  <h5><span class="badge {% if variant_data.var_obj.category == 'sv'%} bg-warning {% else %} bg-secondary {% endif %}">{{variant_data.var_obj.category}}</span>&nbsp;&nbsp;{{variant_data.var_obj.simple_id|truncate(50, True) }}</h5>

  <form method="POST" action="{{ url_for('clinvar.add_variant', institute_id=institute._id, case_name=case.display_name) }}" id="{{variant_data.var_id}}_form">
    <div class="card">
    <!-- Variant data form -->
    <!-- hidden fields -->
    {{ variant_data.var_form.case_id() }}
    {{ variant_data.var_form.category() }}
    {{ variant_data.var_form.local_id() }}
    {{ variant_data.var_form.linking_id() }}
    {{ variant_data.var_form.chromosome() }}
    {{ variant_data.var_form.ref() }}
    {{ variant_data.var_form.alt() }}
    <!-- SNVs only -->
    {% if var_category == 'snv' %}
      {{ variant_data.var_form.start() }}
      {{ variant_data.var_form.stop() }}
    {% endif %}
    <!-- end of hidden fields -->
    <div class="card-body">
      <h5>Variant data</h5>
      <div class="row">
        <div class="col-3"><!-- gene symbols -->
          <div class="col-4">{{variant_data.var_form.gene_symbol.label}}</div>
          <div>{{variant_data.var_form.gene_symbol()}}</div>
        </div>
        <div class="col-2"><!-- Date last eveluation -->
          <div class="col-6">{{variant_data.var_form.last_evaluated.label}}</div>
          <div>{{variant_data.var_form.last_evaluated()}}</div>
        </div>
        <div class="col-3"><!-- model of inherintance -->
          {{variant_data.var_form.inheritance_models.label}}
          {{variant_data.var_form.inheritance_models(class="form-control")}}
        </div>
        <div class="col-2"><!-- Assertion method -->
          {{variant_data.var_form.assertion_method.label}}
          {{variant_data.var_form.assertion_method()}}
        </div>
        <div class="col-2"><!-- Assertion method citation -->
          {{variant_data.var_form.assertion_method_cit.label}}
          {{variant_data.var_form.assertion_method_cit(class="form-control")}}
        </div>
      </div>
      <div class="row d-flex align-items-center mt-3">
        {% if var_category == 'snv' %}
          <div class="col-3"><!-- Transcripts & HGVS:(optional) -->
            {{variant_data.var_form.tx_hgvs.label}}
            {{variant_data.var_form.tx_hgvs()}}
          </div>
          <div class="col-3"><!-- dbSNP identifier -->
            {{variant_data.var_form.dbsnp_id.label}}
            {{variant_data.var_form.dbsnp_id()}}
          </div>
        {% else %} <!--SV variant-->
          <div class="col-2"><!-- Variant type -->
            {{variant_data.var_form.sv_type.label}}
            {{variant_data.var_form.sv_type(class="form-control")}}
          </div>
          <div class="col-2"><!-- Reference copy number -->
            {{variant_data.var_form.ref_copy_number.label}}
            {{variant_data.var_form.ref_copy_number()}}
          </div>
          <div class="col-2"><!-- Copy number -->
            {{variant_data.var_form.copy_number.label}}
            {{variant_data.var_form.copy_number()}}
          </div>
          <div class="col-6">
            <div class="d-flex justify-content-start"><!-- Outer start -->
              <div class="col-3">{{variant_data.var_form.outer_start.label}}</div>
              <div class="col-9">{{variant_data.var_form.outer_start(class="form-control")}}</div>
            </div>
            <div class="d-flex justify-content-start"><!-- Inner start -->
              <div class="col-3">{{variant_data.var_form.inner_start.label}}</div>
              <div class="col-9">{{variant_data.var_form.inner_start(class="form-control")}}</div>
            </div>
            <div class="d-flex justify-content-start"><!-- Inner stop -->
              <div class="col-3">{{variant_data.var_form.inner_stop.label}}</div>
              <div class="col-9">{{variant_data.var_form.inner_stop(class="form-control")}}</div>
            </div>
            <div class="d-flex justify-content-start"><!-- Outer stop -->
              <div class="col-3">{{variant_data.var_form.outer_stop.label}}</div>
              <div class="col-9">{{variant_data.var_form.outer_stop(class="form-control")}}</div>
            </div>
          </div>
        {% endif %}
      </div>
      <div class="row d-flex align-items-center mt-3">
        <div class="col-4"><!-- Clinical significance -->
          {{variant_data.var_form.clinsig.label}}
          {{variant_data.var_form.clinsig(class="form-control")}}
        </div>
        <div class="col-4"> <!-- Clinical significance comment -->
          {{variant_data.var_form.clinsig_comment.label}}
          {{variant_data.var_form.clinsig_comment(class="form-control", placeholder="(optional)")}}
        </div>
        <div class="col-4"> <!-- Clinical significance citation -->
          {{variant_data.var_form.clinsig_cit.label}}
          {{variant_data.var_form.clinsig_cit(class="form-control", placeholder="(optional) e.g. PMID:123456,  PMCID:PMC3385229, NBK:56955")}}
        </div>
      </div>
      <div class="row d-flex align-items-center mt-3">
        <div class="col-4"><!-- HPO terms -->
          {{variant_data.var_form.hpo_terms.label}}
          {{variant_data.var_form.hpo_terms()}}
        </div>
        <div class="col-4"><!-- OMIM terms -->
          {{variant_data.var_form.omim_terms.label}}
          {{variant_data.var_form.omim_terms}}
        </div>
        <div class="col-4"><!-- Additional comments for condition -->
          {{variant_data.var_form.variant_condition_comment.label}}
          {{variant_data.var_form.variant_condition_comment(class="form-control")}}
        </div>
      </div>
      <!-- End of Variant data form -->
    </div> <!--end of card body -->
  </div>
  <div class="card mt-3"> <!-- CaseData fields -->
    <div class="card-body mt-3">
      <h5>Observation data</h5>
      <ul class="list-group">
      {% for cdata in variant_data.cdata_forms %}
        {{cdata.linking_id}} <!-- hidden field -->
        <li class="list-group-item">
          <div class="row">
            <div class="col-2">
              {{ cdata.include_ind.label }}
              {{ cdata.include_ind() }}
            </div>
            <div class="col-2">
              {{ cdata.individual_id.label }}
              {{ cdata.individual_id(class="form-control") }}
            </div>
            <div class="col-2">
              {{ cdata.affected_status.label }}
              {{ cdata.affected_status(class="form-control") }}
            </div>
            <div class="col-2">
              {{ cdata.allele_of_origin.label }}
              {{ cdata.allele_of_origin(class="form-control") }}
            </div>
            <div class="col-2">
              {{ cdata.collection_method.label }}
              {{ cdata.collection_method(class="form-control") }}
            </div>
          </div>
        </li>
      {% endfor %}
      </ul>
    </div>
  </div> <!--end of card div -->
  <div class="mt-3 d-flex justify-content-center">
    <button type="submit" class="btn btn-primary" value="Submit">Add variant to submission object</button>
  </div>
  <br>
</form>
</div> <!-- End of Container of ClinVar variant submission form-->


{% endblock %}


{% block scripts %}
{{ super() }}
{% endblock %}
